CREATE TABLE "user_profile" (
	"id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "user_profile_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),
	"user_id" uuid NOT NULL,
	"display_name" text,
	"github" text,
	"website" text,
	"bluesky" text,
	"mastodon" text,
	"twitter" text,
	"invited_by" uuid,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "user_id_unique" UNIQUE("user_id")
);
--> statement-breakpoint
ALTER TABLE "key_to_user" DROP CONSTRAINT "user_uuid_key_type_unique";--> statement-breakpoint
ALTER TABLE "key_to_user" ALTER COLUMN "key_type" SET DEFAULT 'secp256k1n';--> statement-breakpoint
ALTER TABLE "key_to_user" ADD COLUMN "metadata" jsonb DEFAULT '{}'::jsonb;--> statement-breakpoint
ALTER TABLE "prompts" ADD COLUMN "status" varchar(30) DEFAULT 'draft' NOT NULL;--> statement-breakpoint
ALTER TABLE "user_profile" ADD CONSTRAINT "user_profile_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "auth"."users"("id") ON DELETE cascade ON UPDATE cascade;--> statement-breakpoint
ALTER TABLE "user_profile" ADD CONSTRAINT "user_profile_invited_by_users_id_fk" FOREIGN KEY ("invited_by") REFERENCES "auth"."users"("id") ON DELETE set null ON UPDATE cascade;--> statement-breakpoint
ALTER TABLE "key_to_user" ADD CONSTRAINT "user_uuid_public_key_unique" UNIQUE("user_uuid","public_key");