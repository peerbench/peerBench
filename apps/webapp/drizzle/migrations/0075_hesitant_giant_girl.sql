CREATE TABLE "system_prompt_labels" (
	"id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "system_prompt_labels_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),
	"prompt_id" integer NOT NULL,
	"version" integer NOT NULL,
	"label" varchar(20) NOT NULL,
	"assigned_at" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "unique_prompt_label" UNIQUE("prompt_id","label")
);
--> statement-breakpoint
CREATE TABLE "system_prompt_versions" (
	"id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "system_prompt_versions_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),
	"prompt_id" integer NOT NULL,
	"version" integer NOT NULL,
	"type" varchar(10) NOT NULL,
	"prompt" jsonb NOT NULL,
	"config" jsonb,
	"sha256_hash" text NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "system_prompt_versions_sha256_hash_unique" UNIQUE("sha256_hash"),
	CONSTRAINT "unique_prompt_version" UNIQUE("prompt_id","version")
);
--> statement-breakpoint
CREATE TABLE "system_prompts" (
	"id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "system_prompts_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),
	"name" text NOT NULL,
	"tags" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"updated_at" timestamp DEFAULT now() NOT NULL,
	CONSTRAINT "system_prompts_name_unique" UNIQUE("name")
);
--> statement-breakpoint
ALTER TABLE "system_prompt_labels" ADD CONSTRAINT "system_prompt_labels_prompt_id_system_prompts_id_fk" FOREIGN KEY ("prompt_id") REFERENCES "public"."system_prompts"("id") ON DELETE cascade ON UPDATE cascade;--> statement-breakpoint
ALTER TABLE "system_prompt_labels" ADD CONSTRAINT "system_prompt_labels_prompt_id_version_system_prompt_versions_prompt_id_version_fk" FOREIGN KEY ("prompt_id","version") REFERENCES "public"."system_prompt_versions"("prompt_id","version") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_prompt_versions" ADD CONSTRAINT "system_prompt_versions_prompt_id_system_prompts_id_fk" FOREIGN KEY ("prompt_id") REFERENCES "public"."system_prompts"("id") ON DELETE cascade ON UPDATE cascade;--> statement-breakpoint
CREATE INDEX "idx_system_prompt_versions_sha256" ON "system_prompt_versions" USING btree ("sha256_hash");