ALTER TABLE "prompts" ALTER COLUMN "hash_sha256_registration" SET NOT NULL;--> statement-breakpoint
ALTER TABLE "prompts" ALTER COLUMN "hash_cid_registration" SET NOT NULL;--> statement-breakpoint
CREATE OR REPLACE VIEW "public"."v_quick_feedbacks" AS (select "quick_feedbacks"."id", "quick_feedbacks"."created_at", "quick_feedbacks"."prompt_id", "quick_feedbacks"."response_id", "quick_feedbacks"."score_id", "quick_feedbacks"."opinion", "quick_feedbacks"."user_id", coalesce(jsonb_agg(jsonb_build_object('id',"review_flags"."id",'flag',"review_flags"."flag",'opinion',"review_flags"."opinion")) filter (where "review_flags"."flag" is not null),'[]'::jsonb) as "flags" from "quick_feedbacks" left join "quick_feedbacks_quick_feedback_flags" on "quick_feedbacks_quick_feedback_flags"."quick_feedback_id" = "quick_feedbacks"."id" left join "review_flags" on "review_flags"."id" = "quick_feedbacks_quick_feedback_flags"."flag_id" group by "quick_feedbacks"."id", "quick_feedbacks"."user_id");