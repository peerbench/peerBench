CREATE TABLE "notifications" (
	"id" integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "notifications_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START WITH 1 CACHE 1),
	"user_id" uuid NOT NULL,
	"content" text NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"type" varchar(20) NOT NULL,
	"created_at" timestamp DEFAULT now() NOT NULL,
	"read_at" timestamp
);
--> statement-breakpoint
ALTER TABLE "notifications" ADD CONSTRAINT "notifications_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "auth"."users"("id") ON DELETE cascade ON UPDATE cascade;--> statement-breakpoint
CREATE VIEW "public"."v_user_notification_subscriptions" AS (((select "prompt_id", "user_id", 'commented' as "reason" from "prompt_comments") union (select "prompt_id", "user_id", 'gave_quick_feedback' as "reason" from "quick_feedbacks" where "quick_feedbacks"."prompt_id" is not null)) union (select "id" as "prompt_id", "uploader_id", 'owns' as "reason" from "prompts"));